import{Jb as r,T as u,Z as c,gd as n,md as h,qd as d,sd as l,ta as o,td as m,ud as f,vd as I,yd as a}from"./chunk-KJXX4TUL.js";var q=(()=>{class e{constructor(){this.firestore=c(d),this.auth=c(n),this.user=o(null),this.cartItems=o([]),this.cartCount=r(()=>this.cartItems().reduce((t,i)=>t+i.quantity,0)),this.cartSubTotal=r(()=>this.cartItems().reduce((t,i)=>t+i.quantity*i.product.price,0)),this.cartTax=r(()=>this.cartSubTotal()*.08),this.cartTotal=r(()=>this.cartSubTotal()+this.cartTax()),h(this.auth,t=>{this.user.set(t),this.cartSubscription?.unsubscribe(),t?this.loadCartFromFirebase():this.clearLocalCart()})}get userId(){return this.user()?.uid??"anon"}cartCollection(){return m(this.firestore,`carts/${this.userId}/items`)}getItemDoc(t){return I(this.firestore,`carts/${this.userId}/items/${t}`)}loadCartFromFirebase(){this.cartSubscription=l(this.cartCollection(),{idField:"id"}).subscribe(t=>{this.cartItems.set(t)})}addProduct(t){if(!this.user())return;let b=this.cartItems().findIndex(s=>s.product.id===t.id),p=this.cartItems().find(s=>s.product.id===t.id),C=b>=0?{product:t,quantity:(p?.quantity||0)+1}:{product:t,quantity:1};a(this.getItemDoc(t.id),C)}updateCartQuantity(t){this.user()&&a(this.getItemDoc(t.product.id),t)}removeProduct(t){this.user()&&f(this.getItemDoc(t.id))}clearLocalCart(){this.cartItems.set([]),this.cartSubscription?.unsubscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();export{q as a};
